const int but1 = 31;
const int but2 = PUSH2;   // or pin 17
const int green  = 39;
const int blue = 40;
const int red = 30;
int lbut1 = 0;
int lbut2 = 0;
int lbut1state = 0; //Button 1 state
int x = 10;
int byte0 = 0;
int byte1 = 0;
int byte2 = 0;
int byte3 = 0;
 
void setup() {
  Serial.begin(9600); 
  pinMode(but1, INPUT_PULLUP);
  pinMode(but2, INPUT_PULLUP);
  pinMode(red, OUTPUT);
  pinMode(blue, OUTPUT);
  pinMode(green, OUTPUT);
}

int cm = 0; 
int pm = 0;
int inter = 100; //data rate in ms
int greenie=0;
int b;
int ab; //column counter

//Simulation data


const float RPM[] = {864,4,2,0.1,0, 98.499466,98.528732,98.610039,98.591064,98.487541,98.477783,98.509224,98.564507,98.598656,98.599739,98.599739,98.567223,98.4618,98.45475,98.53524,98.500549,88.394409,54.132389,22.469534,13.934111,14.270693,14.36202,14.352263,14.315949,14.36473,14.488577,14.456869,14.412968,14.445216,14.366627,14.533834,14.514864,14.39996,14.39996,14.363375,14.376383,14.407819,14.393456,15.737888,19.281487,21.170902,21.346237,21.209383,20.666569,23.069799,28.205524,33.726887,41.194298,53.090935,74.772308,92.142075,97.787277,98.572906,98.52169,98.497025,98.445808,98.457458,98.494591,98.532799,84.151085,48.425125,23.860849,18.127569,16.774464,16.551161,16.050352,14.155518,13.558503,16.029484,17.140043,18.489353,19.902349,21.687969,25.390375,25.953514,21.305588,18.712658,17.062267,13.943053,13.586146,14.231127,14.186954,14.222184,14.337088,14.030586,13.856605,17.69993,20.512913,23.109907,26.284405,27.509056,30.1654,39.861248,49.808311,60.945339,68.295677,60.03017,40.269917,22.712893,17.774185,25.08848,36.043667,39.64011,33.702766,27.618267,26.948626,27.613117,28.100647,26.192265,22.591213,22.28417,25.134008,27.269762,27.206076,29.200367,30.233149,28.741835,26.074921,25.105282,29.672451,32.412262,28.720697,26.739685,29.457546,34.673218,36.012772,30.213909,27.977886,29.866486,31.073521,33.866447,38.341206,43.417583,46.97961,52.277393,55.245659,50.119961,45.708889,48.845718,65.576462,85.550262,96.119545,98.510849,98.512558};
const float LatAcc[] = {0,0,0,0,0, -0.96864,-0.256445,-0.004274,-0.234384,-0.416131,-0.085968,0.316087,0.350908,0.33567,-0.010328,0.340694,0.266567,0.133674,-0.200001,-0.267439,-0.303834,-0.09607,0.105329,-0.080605,-0.038029,0.092129,-0.011635,-0.002765,-0.035126,-0.121615,0.165388,0.064038,0.070248,0.055328,-0.106458,-0.704303,-1.032833,-0.888709,-1.021888,-1.133671,-1.173036,-1.126429,-0.897959,-0.949994,-0.998407,-0.959399,-0.947973,-1.001333,-1.01825,-1.018991,-1.022683,-1.028434,-1.11356,-1.028273,-0.482931,-0.454623,-0.539676,-0.443071,-0.269384,-0.367066,-0.391744,0.04011,0.763049,1.073894,0.943376,0.937481,0.986575,0.924998,0.794152,0.417867,0.010707,-0.342607,-1.087001,-1.154519,-1.201212,-1.226457,-1.006203,-0.916235,-0.662654,-0.264517,0.632515,1.187456,1.169342,1.264345,1.280621,1.357595,1.073652,1.127661,1.187844,0.796725,-0.76456,-1.192474,-1.040102,-1.300502,-1.119813,-1.102982,-0.819828,-0.408758,-0.353099,-0.174449,0.567562,1.005134,1.035236,1.305879,1.263753,1.23473,0.503956,-0.702573,-1.04182,-1.248007,-1.136426,-1.229691,-1.20421,-1.297486,-1.13792,-1.091652,-1.25459,-0.981253,-1.187234,-1.257403,-1.209859,-1.213754,-1.174605,-0.941657,-1.089207,-0.945034,-1.134987,-0.91647,-0.897411,-0.626743,-0.776906,-0.92825,-1.126845,-0.841825,-1.135764,-1.062095,-1.319673,-0.730598,-1.036883,-1.341849,-1.238755,-0.275276,-0.956053,-0.951328,-1.269707,-1.215469,-1.26292,-0.340827,-0.264619};
const float ThrotPos[] = {864,0,2,1,0, 11658.121094,12005.581055,12295.1875,12383.853516,12208.767578,11952.007813,11859.273438,11987.017578,12235.256836,12466.585938,12676.044922,12905.847656,13143.874023,13324.808594,13500.106445,13692.78125,13815.057617,13690.450195,12774.374023,11282.518555,9946.549805,8820.209961,7768.040527,6726.085449,5810.263672,5249.106445,4923.220215,4783.100586,4863.205078,5091.143555,5345.783203,5393.252441,5170.061523,4930.510254,4801.707031,4709.311035,4623.441895,4556.942383,4454.883301,4346.593262,4405.040039,4601.190918,4782.083496,4839.597656,4856.890137,4917.329102,5006.800781,5087.879883,5493.108398,6248.211914,7140.341309,7874.974121,8240.955078,8317.415039,8251.338867,8209.887695,8188.399414,8212.727539,8500.808594,9029.923828,9442.822266,9283.206055,8886.540039,8577.818359,8333.223633,8359.205078,8303.724609,8113.974121,8057.39209,7958.511719,7831.361328,7783.086426,7769.015137,7840.219727,7862.004395,7751.425781,7634.913574,7568.499023,7441.984375,7147.800781,6961.313965,6841.834961,6491.408203,6051.849609,5826.115234,5843.746582,5823.148438,5831.709473,5897.955078,5987.893066,6078.678223,6130.979492,6226.00293,6326.536621,6464.410156,6696.247559,7086.811035,7553.325684,7710.017578,7611.645508,7528.785645,7499.329102,7568.499023,7732.268555,7920.027344,8072.353516,8103.590332,8089.942871,8120.077148,8123.255859,8022.849609,7912.186523,7901.929688,7943.550293,7947.068359,7970.040039,7930.114746,7847.424805,7772.109375,7753.587891,7814.323242,7962.029297,8002.929199,7942.320801,7959.698242,8113.126465,8270.157227,8331.0625,8416.888672,8488.813477,8564.170898,8731.162109,9052.301758,9491.436523,9922.561523,10306.385742,10698.771484,10891.404297,10857.582031,10920.90332,11259.844727,11776.75293,12284.209961,12326.836914};
int ie =  sizeof(RPM); 
int i = 5;

void loop() {
  if(digitalRead(but1) == LOW && lbut2 != 1){
//    Serial.print("Starting Data Point:  ");  
//    Serial.print(i);
      while(digitalRead(but2)!=LOW){
      cm = millis();
      if(cm-pm>inter){
        pm = cm;
        if(i < ie){
          printie();
        }
      }
    }   
    b=1;
  }
  else if(b != 0){
//    Serial.println("\n\n\tStopped....\n\tWaiting for input to send data...\n");
//    Serial.print("Ending Data Point:  ");  
//    Serial.print(i);
//    Serial.print("\n\n");
    b = 0;
  }
  else{
    analogWrite(red,0);
    cm = millis();
    if(cm-pm>500){
      pm = cm;
      if(greenie == 0){
        analogWrite(green, 10);
        greenie = 1;
//        Serial.println("greenie: on");
        }
      else{
        analogWrite(green, 0);
        greenie = 0;
//        Serial.println("greenie: off");
//          delay(500);
        }     
    }
  }
}

void printie(){
    analogWrite(red, x);
//    ab += 1
//    float b0 = RPM[i]
//    float b1 = LatAcc[i]
//    float b2 = ThrotPos[i]
//    Serial.print(",");

    Serial.print("\n");
    Serial.print(RPM[i]);
    Serial.print(",");
    Serial.print(LatAcc[i]);
    Serial.print(",");
    Serial.print(ThrotPos[i]);
     

//    Serial.print(",");
//    Serial.print(byte3, BIN);
    lbut1state = 0;
    i = i + 1;
//    return i; 
}
